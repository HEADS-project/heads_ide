<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Model HD-Service logic with ThingML components | HEADS IDE &amp; Methodology</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.4.3">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
    

        
    
    
    <link rel="next" href="../heads_methodology/compile_thingml_components_to_platform_specific_code.html" />
    
    
    <link rel="prev" href="../heads_methodology/for_service_developers.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="3.2.1" data-basepath=".." data-revision="Mon Nov 02 2015 11:17:14 GMT+0100 (CET)">
    

<div class="book-summary">
    <div class="book-search" role="search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="heads_actors/index.html">
            
                
                    <a href="../heads_actors/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        HEADS Actors
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="heads_actors/platform_experts.html">
            
                
                    <a href="../heads_actors/platform_experts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Platform Experts
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="heads_actors/service_developers.html">
            
                
                    <a href="../heads_actors/service_developers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Service Developers
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="heads_actors/service_operators.html">
            
                
                    <a href="../heads_actors/service_operators.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Service Operators
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="heads_ide/index.html">
            
                
                    <a href="../heads_ide/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        HEADS IDE
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="heads_ide/design-time.html">
            
                
                    <a href="../heads_ide/design-time.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        @Design-time
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="heads_ide/runtime.html">
            
                
                    <a href="../heads_ide/runtime.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        @Runtime
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="heads_ide/installation_guide.html">
            
                
                    <a href="../heads_ide/installation_guide.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Installation Guide
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="heads_methodology/index.html">
            
                
                    <a href="../heads_methodology/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        HEADS Methodology
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="heads_methodology/for_platform_experts.html">
            
                
                    <a href="../heads_methodology/for_platform_experts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        For Platform Experts
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="heads_methodology/create_libraries_to_support_platform_specific_features__library__component.html">
            
                
                    <a href="../heads_methodology/create_libraries_to_support_platform_specific_features__library__component.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.1.</b>
                        
                        Create libraries to support platform specific features / library / component
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="heads_methodology/extend_the_thingml_transformations_to_compile_code_for_a_new_platform.html">
            
                
                    <a href="../heads_methodology/extend_the_thingml_transformations_to_compile_code_for_a_new_platform.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.2.</b>
                        
                        Extend the ThingML transformations to compile code for a new platform
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="heads_methodology/kevoree-platform-integration/index.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.</b>
                        
                        Extend Kevoree to deploy code for a new platform
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.3.1" data-path="heads_methodology/kevoree-platform-integration/generalities.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/generalities.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.1.</b>
                        
                        Generalities
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3.2" data-path="heads_methodology/kevoree-platform-integration/model.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/model.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.2.</b>
                        
                        Kevoree Model
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.3.2.1" data-path="heads_methodology/kevoree-platform-integration/kevoree-schema.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/kevoree-schema.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.2.1.</b>
                        
                        Kevoree MM V5 JsonSchema
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.3.3" data-path="heads_methodology/kevoree-platform-integration/core.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/core.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.3.</b>
                        
                        Core
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3.4" data-path="heads_methodology/kevoree-platform-integration/remote_code_loader.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/remote_code_loader.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.4.</b>
                        
                        Remote Code Loader
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3.5" data-path="heads_methodology/kevoree-platform-integration/registry_client.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/registry_client.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.5.</b>
                        
                        Registry Client
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3.6" data-path="heads_methodology/kevoree-platform-integration/logger.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/logger.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.6.</b>
                        
                        Logger
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3.7" data-path="heads_methodology/kevoree-platform-integration/model_generator.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/model_generator.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.7.</b>
                        
                        Kevoree Model generation
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3.8" data-path="heads_methodology/kevoree-platform-integration/code_generator.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/code_generator.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.8.</b>
                        
                        Code generator
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3.9" data-path="heads_methodology/kevoree-platform-integration/runtime.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/runtime.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.9.</b>
                        
                        Runtime
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3.10" data-path="heads_methodology/kevoree-platform-integration/kevscript.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/kevscript.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.10.</b>
                        
                        Kevscript Tools
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3.11" data-path="heads_methodology/kevoree-platform-integration/components/index.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/components/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.11.</b>
                        
                        Components
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.3.11.1" data-path="heads_methodology/kevoree-platform-integration/components/component.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/components/component.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.11.1.</b>
                        
                        Component
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3.11.2" data-path="heads_methodology/kevoree-platform-integration/components/node.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/components/node.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.11.2.</b>
                        
                        Node
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3.11.3" data-path="heads_methodology/kevoree-platform-integration/components/group.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/components/group.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.11.3.</b>
                        
                        Group
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3.11.4" data-path="heads_methodology/kevoree-platform-integration/components/channel.html">
            
                
                    <a href="../heads_methodology/kevoree-platform-integration/components/channel.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.11.4.</b>
                        
                        Channel
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="heads_methodology/extend_kevoree_to_support_a_new_communication_channel.html">
            
                
                    <a href="../heads_methodology/extend_kevoree_to_support_a_new_communication_channel.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.4.</b>
                        
                        Extend Kevoree to support a new communication channel
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="heads_methodology/for_service_developers.html">
            
                
                    <a href="../heads_methodology/for_service_developers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        For Service Developers
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="3.2.1" data-path="heads_methodology/model_hd-service_logic_with_thingml_components.html">
            
                
                    <a href="../heads_methodology/model_hd-service_logic_with_thingml_components.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.1.</b>
                        
                        Model HD-Service logic with ThingML components
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="heads_methodology/compile_thingml_components_to_platform_specific_code.html">
            
                
                    <a href="../heads_methodology/compile_thingml_components_to_platform_specific_code.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.2.</b>
                        
                        Compile ThingML components to platform specific code
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="heads_methodology/model_hd-service_deployment_with_kevoree.html">
            
                
                    <a href="../heads_methodology/model_hd-service_deployment_with_kevoree.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.3.</b>
                        
                        Model HD-Service deployment with Kevoree
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2.4" data-path="heads_methodology/deploy_platform_specific_code_using_kevoree.html">
            
                
                    <a href="../heads_methodology/deploy_platform_specific_code_using_kevoree.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.4.</b>
                        
                        Deploy platform specific code using Kevoree
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="heads_methodology/for_service_operators.html">
            
                
                    <a href="../heads_methodology/for_service_operators.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        For Service Operators
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="heads_methodology/visualize_the_configuration_and_status_of_a_running_hd-service.html">
            
                
                    <a href="../heads_methodology/visualize_the_configuration_and_status_of_a_running_hd-service.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.1.</b>
                        
                        Visualize the configuration and status of a running HD-Service
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="heads_methodology/modify_the_configuration_and_deployment_of_a_running_hd-service.html">
            
                
                    <a href="../heads_methodology/modify_the_configuration_and_deployment_of_a_running_hd-service.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.2.</b>
                        
                        Modify the configuration and deployment of a running HD-Service
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3.3" data-path="heads_methodology/re-deployadaptreconfigure_a_running_hd-service.html">
            
                
                    <a href="../heads_methodology/re-deployadaptreconfigure_a_running_hd-service.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.3.</b>
                        
                        Re-deploy/adapt/reconfigure a running HD-Service
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="credits/index.html">
            
                
                    <a href="../credits/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Credits
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="license/index.html">
            
                
                    <a href="../license/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        License
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >HEADS IDE &amp; Methodology</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="model-hd-service-logic-with-thingml-components">Model HD-Service logic with ThingML components</h1>
<p>The service developer uses ThingML to define the components of the HD-Service and implement the logic of those components.</p>
<p>State machines are a common formalism to express reactive behavior that needs to react on some events, correlate events, and produce some new events. A state machine-based programming language, and ThingML in particular, is thus a good candidate to implement Kevoree components and write the logic that orchestrates the different ports of this component.</p>
<h2 id="define-interfaces">Define interfaces:</h2>
<p>Let&apos;s consider a simple ThingML program made of two things, basically involving message to deal with a timer:</p>
<pre><code>thing fragment TimerMsgs {
    // Start the Timer
    message timer_start(delay : Integer);
    // Cancel the Timer
    message timer_cancel();
    // Notification that the timer has expired
    message timer_timeout();
}
</code></pre><p>First, a timer:</p>
<pre><code>thing fragment Timer includes TimerMsgs
{
    provided port timer
    {
        sends timer_timeout
        receives timer_start, timer_cancel
    }
}
</code></pre><h2 id="implement-the-logic-using-state-machines-and-action-languages">Implement the logic using state machines and action languages</h2>
<p>A simple client using the timer could be:</p>
<pre><code>thing HelloTimer includes TimerMsgs {

    required port timer {
        receives timer_timeout
        sends timer_start, timer_cancel
    }

    readonly property period : Integer = 1000
    property counter : Integer = 0

    statechart behavior init Init {

        state Init {
            on entry do
                timer!timer_start(period)
            end

            transition -&gt; Init //this will loop on the Init state, and start a new timer
            event timer?timer_timeout
            action do
                        print &quot;hello &quot;
                print counter
                        print &quot;\n&quot;
                        counter = counter + 1
            end
        }
    }
}
</code></pre><p>This simple, platform-independent service basically outputs a &quot;hello n&quot; every second. This is realized by starting a timer when entering the <code>Init</code> state. On timeout, a <code>timer_timeout</code> message is received, triggering the prints, before it re-enters the <code>Init</code> state.</p>
<p>Basically, this would produce the following outputs:</p>
<pre><code>hello 0
hello 1
hello 2
</code></pre><p>Alternatively, the previous example can be refactored in the following way to keep the state machine clean:</p>
<pre><code>thing HelloTimer includes TimerMsgs {

    required port timer {
        receives timer_timeout
        sends timer_start, timer_cancel
    }

    readonly property period : Integer = 1000
    property counter : Integer = 0

    function printHello() do
        print &quot;hello &quot;
    print counter
        print &quot;\n&quot;
        counter = counter + 1
    end

    statechart behavior init Init {

        state Init {
        on entry do
            timer!timer_start(period)
        end

        transition -&gt; Init //this will loop on the Init state, and start a new timer
        event timer?timer_timeout
        action printHello()
    }
    }
}
</code></pre><p>More generally the general syntax for a function is:</p>
<pre><code>function myFunction(param1 : ParamType1, param2 : ParamType2) : ReturnType do
    ...
end
</code></pre><p>Like in most programming languages, functions are particularly useful to encapsulate code that is called from multiple places, to avoid duplication.</p>
<blockquote>
<p>The HEADS action and expression language is fairly aligned with major programming languages such as Java, JavaScript or C: </p>
<ul>
<li>variable definitions and affectations <code>var i : Integer = 0</code>,</li>
<li>algebraic (<code>+</code>, <code>-</code>, etc) and boolean operators (<code>and</code> and <code>or</code>)</li>
<li>control structures <code>if (true) do ... end else do ... end</code>, <code>while(true) do ... end</code></li>
<li><code>print &quot;hello&quot;</code> and <code>error &quot;alert!&quot;</code></li>
<li>function calls <code>myFunction(0, 1)</code></li>
</ul>
<p>In addition to the &quot;normal&quot; statements common with those language, HEADS provides:</p>
<ul>
<li>send a message <code>myPort!myMessage()</code>, <code>myPort!myMessage2(a, b, 0)</code> for asynchronous message passing between components</li>
</ul>
</blockquote>
<h2 id="implement-advanced-logic-with-complex-event-processing">Implement advanced logic with Complex Event Processing</h2>
<p>The HEADS modelling language has been extended with CEP concepts (See D2.2 for more details). CEP complements state machines and provides more powerful abstractions to handle streams of events, for example to compute the average of the values provided by a sensor on a given time window, or to when some behavior should be triggered when two events happen &quot;at the same time&quot;. While this can be expressed with state machines, this typically implies instantiating timers and arrays (to manage time windows), managing different interleaving, etc, <em>i.e.</em> this generates accidental complexity. Those CEP concepts are mapped to the ones provided by <a href="http://reactivex.io/" target="_blank">ReactiveX</a>.</p>
<h3 id="join">Join</h3>
<p>The <a href="http://reactivex.io/documentation/operators/join.html" target="_blank">join operator</a> &quot;<em>combines items emitted by two Observables whenever an item from one Observable is emitted during a time window defined according to an item emitted by the other Observable</em>&quot;. See the figure below (taken from ReactiveX documentation) to get an idea of how it works.</p>
<p><img src="http://reactivex.io/documentation/operators/images/join.c.png" alt="Join"></p>
<p>This is expressed in the HEADS modelling language using this syntax:</p>
<pre><code>stream simpleJoinWithParams @TTL &quot;100&quot; do
    from [e1 : receivePort?m1 &amp; e2 : receivePort?m2 -&gt; cep1(e1.v1 + e2.v1)]
    select a : #0, b : #1
    action sendPort!cep1(a, b)
end
</code></pre><p>Whenever a message <code>m1</code> and a message <code>m2</code> are received within 100 ms, it will produce a <code>cep1</code> message.</p>
<p>The same query expressed directly using the ReactiveX API would require about 15 lines of code (in Java or here in JavaScript):</p>
<pre><code class="lang-js"><span class="hljs-comment">//Code sample taken from ReactiveX documentation</span>
<span class="hljs-keyword">var</span> xs = Rx.Observable.interval(<span class="hljs-number">100</span>)
    .map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">&apos;first&apos;</span> + x; });

<span class="hljs-keyword">var</span> ys = Rx.Observable.interval(<span class="hljs-number">100</span>)
    .map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">&apos;second&apos;</span> + x; });

<span class="hljs-keyword">var</span> source = xs
    .join(
        ys,
        <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> Rx.Observable.timer(<span class="hljs-number">0</span>); },
        <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> Rx.Observable.timer(<span class="hljs-number">0</span>); },
        <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{ <span class="hljs-keyword">return</span> x + y; }
    )
    .take(<span class="hljs-number">5</span>);

<span class="hljs-keyword">var</span> subscription = source.subscribe(
    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) </span>{ <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Next: &apos;</span> + x); },
    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{ <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Error: &apos;</span> + err); },
    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Completed&apos;</span>); });
</code></pre>
<p>The declarative syntax of the HEADS modelling language for CEP concepts hence greatly simplifies the expression of CEP queries. Moreover, the stream expressed above can be compiled to Java or JavaScript with no modification, the compiler taking care of mapping to the Java and JS version of the ReactiveX APIs.</p>
<h3 id="merge">Merge</h3>
<p>The <a href="http://reactivex.io/documentation/operators/merge.html" target="_blank">Merge operator</a> &quot;<em>combine multiple Observables into one by merging their emissions</em>&quot;. See the figure below (taken from ReactiveX documentation) to get an idea of how it works.</p>
<p><img src="http://reactivex.io/documentation/operators/images/merge.png" alt="Merge"></p>
<p>This is expressed in the HEADS modelling language using this syntax:</p>
<pre><code>stream simpleMerge do
    from [e1 : receivePort?m1 | e2 : receivePort?m2 -&gt; cep1()]
    action sendPort!cep1()
end
</code></pre><p>The same query expressed directly using the ReactiveX API would require about 15 lines of code (in JavaScript or here in Java):</p>
<pre><code class="lang-java"><span class="hljs-comment">//Code sample taken from ReactiveX documentation</span>
Observable&lt;Integer&gt; odds = Observable.just(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>).subscribeOn(someScheduler);
Observable&lt;Integer&gt; evens = Observable.just(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>);

Observable.merge(odds, evens)
          .subscribe(<span class="hljs-keyword">new</span> Subscriber&lt;Integer&gt;() {
        <span class="hljs-annotation">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onNext</span><span class="hljs-params">(Integer item)</span> </span>{
            System.out.println(<span class="hljs-string">&quot;Next: &quot;</span> + item);
        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(Throwable error)</span> </span>{
            System.err.println(<span class="hljs-string">&quot;Error: &quot;</span> + error.getMessage());
        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCompleted</span><span class="hljs-params">()</span> </span>{
            System.out.println(<span class="hljs-string">&quot;Sequence complete.&quot;</span>);
        }
    });
</code></pre>
<h3 id="filter">Filter</h3>
<p>A <a href="http://reactivex.io/documentation/operators/filter.html" target="_blank">Filter</a> &quot;<em>emits only those items from an Observable that pass a predicate test</em>&quot;. See the figure below (taken from ReactiveX documentation) to get an idea of how it works.</p>
<p><img src="http://reactivex.io/documentation/operators/images/filter.png" alt="Filter"></p>
<p>This is expressed in the HEADS modelling language using this syntax:</p>
<pre><code>operator lessThan4(m : m1) : Boolean 
    return m.x &lt; 4

stream filterLessThan4 do
        from m : [ e1 : recv?m1 -&gt; res(e1.x)]::filter(lessThan4(m))
        select a : #0
        action send!res(a)
    end
</code></pre><p>The same query expressed directly using the ReactiveX API would require about 15 lines of code (in JavaScript or here in Java):</p>
<pre><code class="lang-java"><span class="hljs-comment">//Code sample taken from ReactiveX documentation</span>
Observable.just(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
          .filter(<span class="hljs-keyword">new</span> Func1&lt;Integer, Boolean&gt;() {
              <span class="hljs-annotation">@Override</span>
              <span class="hljs-function"><span class="hljs-keyword">public</span> Boolean <span class="hljs-title">call</span><span class="hljs-params">(Integer item)</span> </span>{
                <span class="hljs-keyword">return</span>( item &lt; <span class="hljs-number">4</span> );
              }
          }).subscribe(<span class="hljs-keyword">new</span> Subscriber&lt;Integer&gt;() {
        <span class="hljs-annotation">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onNext</span><span class="hljs-params">(Integer item)</span> </span>{
            System.out.println(<span class="hljs-string">&quot;Next: &quot;</span> + item);
        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(Throwable error)</span> </span>{
            System.err.println(<span class="hljs-string">&quot;Error: &quot;</span> + error.getMessage());
        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCompleted</span><span class="hljs-params">()</span> </span>{
            System.out.println(<span class="hljs-string">&quot;Sequence complete.&quot;</span>);
        }
    });
</code></pre>
<h3 id="aggregator-and-windows">Aggregator and Windows</h3>
<p>A <a href="http://reactivex.io/documentation/operators/buffer.html" target="_blank">Window (or Buffer)</a> &quot;<em>periodically gathers items emitted by an Observable into bundles and emit these bundles rather than emitting the items one at a time</em>&quot;. See the figure below (taken from ReactiveX documentation) to get an idea of how it works.</p>
<p><img src="http://reactivex.io/documentation/operators/images/Buffer.png" alt="Buffer"></p>
<p>This is expressed in the HEADS modelling language using this syntax:</p>
<pre><code>stream lengthW do // compute min, max, average of m2.x on windows of 5 seconds
    from e : [recv?m2]::timeWindow(5000, 5000)
    select avg : average(e.x[]), min : min(e.x[]), max : max(e.x[])
    action send!res2(avg, min, max)
end
</code></pre><p>Aggregators are normal functions that takes arrays (corresponding to the content of a window/buffer) as parameter:</p>
<pre><code>function average(x : Integer[]) : Float do
    var i : Integer = 0
    var sum : Integer = 0
    while (i &lt; x.length) do
        sum = sum + x[i]
    i = i + 1
    end
    return sum / x.length
end
</code></pre><p>Those aggregators are typically defined in a reusable libraries that any stream can then use directly.</p>
<h2 id="debugging">Debugging</h2>
<p>Traces are a common way of understanding the execution of a program, identify and solve bugs. Traces can automatically be added to trace:</p>
<ul>
<li>the initialization of instances, with values for all attributes. Those traces appear in light blue in the figure below.</li>
<li>the execution of the state machine (which states are being entered/exited, which transition are triggered, etc). Those traces appear in yellow in the figure below.</li>
<li>the emission/reception of messages on ports. Those traces appear in green in the figure below.</li>
<li>the affectation of variables. Those traces appear in magenta/purple in the figure below.</li>
<li>the execution of functions. Those traces appear in dark blue (not present in the figure below).</li>
</ul>
<p>Using <code>@debug &quot;true&quot;</code> and <code>@debug &quot;false&quot;</code> the service developer can finely filter the elements he wants to trace.</p>
<p><img src="traces.png" alt="Traces"></p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../heads_methodology/for_service_developers.html" class="navigation navigation-prev " aria-label="Previous page: For Service Developers"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../heads_methodology/compile_thingml_components_to_platform_specific_code.html" class="navigation navigation-next " aria-label="Next page: Compile ThingML components to platform specific code"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
